# ç®€ä»‹

## Keq æ˜¯ä»€ä¹ˆï¼Ÿ

Keq æ˜¯ä¸€ä¸ª**ç°ä»£åŒ–çš„ TypeScript HTTP å®¢æˆ·ç«¯**ï¼ŒåŸºäº [Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API) æ„å»ºï¼ŒåŒæ—¶æ”¯æŒæµè§ˆå™¨å’Œ Node.js ç¯å¢ƒã€‚å®ƒèåˆäº† [koa](https://github.com/koajs/koa) çš„ä¸­é—´ä»¶è®¾è®¡ç†å¿µå’Œ [superagent](https://github.com/ladjs/superagent) çš„é“¾å¼è°ƒç”¨ä½“éªŒï¼Œè®© HTTP è¯·æ±‚å˜å¾—ä¼˜é›…è€Œå¼ºå¤§ã€‚

### ä¸ºä»€ä¹ˆé€‰æ‹© Keqï¼Ÿ

ä¸ä¼ ç»Ÿçš„ HTTP å®¢æˆ·ç«¯ä¸åŒï¼ŒKeq ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå‘é€è¯·æ±‚çš„å·¥å…·â€”â€”å®ƒæ˜¯ä¸€ä¸ª**å¯ç»„åˆã€å¯æ‰©å±•çš„è¯·æ±‚è§£å†³æ–¹æ¡ˆ**ï¼š

- ğŸ¯ **ä» API æ–‡æ¡£åˆ°ä»£ç **ï¼šé€šè¿‡ [@keq-request/cli](./libraries/keq-cli) å°† Swagger/OpenAPI æ–‡æ¡£ç›´æ¥è½¬æ¢ä¸ºç±»å‹å®‰å…¨çš„è¯·æ±‚å‡½æ•°ï¼Œå‘Šåˆ«æ‰‹å†™é‡å¤çš„è¯·æ±‚ä»£ç 
- ğŸ§© **æ´‹è‘±æ¨¡å‹ä¸­é—´ä»¶**ï¼šåƒ Koa ä¸€æ ·ä¼˜é›…åœ°ç»„åˆåŠŸèƒ½ï¼Œè½»æ¾å®ç°è¶…æ—¶æ§åˆ¶ã€è‡ªåŠ¨é‡è¯•ã€é”™è¯¯å¤„ç†ã€ç¼“å­˜ç­‰å¤æ‚é€»è¾‘
- ğŸ”— **é“¾å¼è°ƒç”¨ API**ï¼šæµç•…çš„è°ƒç”¨ä½“éªŒï¼Œæ— éœ€è‡ƒè‚¿çš„é…ç½®å¯¹è±¡ï¼Œæ‰€æœ‰å‚æ•°ä¸€ç›®äº†ç„¶
- ğŸ“˜ **å®Œå¤‡çš„ TypeScript æ”¯æŒ**ï¼šä»è¯·æ±‚å‚æ•°åˆ°å“åº”ä½“ï¼Œå…¨é“¾è·¯ç±»å‹æ¨æ–­ï¼Œè®©ç¼–è¾‘å™¨æˆä¸ºä½ çš„æœ€ä½³æ–‡æ¡£
- ğŸ¨ **çµæ´»çš„è·¯ç”±ç³»ç»Ÿ**ï¼šæ ¹æ®åŸŸåã€è·¯å¾„ã€æ¨¡å—ç­‰æ¡ä»¶ç²¾å‡†åº”ç”¨ä¸­é—´ä»¶ï¼Œå®ç°ç»†ç²’åº¦çš„è¯·æ±‚æ§åˆ¶

### ä¸€ä¸ªç®€å•çš„ä¾‹å­

```typescript
import { request } from "keq";

// ç®€æ´çš„é“¾å¼è°ƒç”¨
const cats = await request
  .get("/cats")
  .query("breed", "british_shorthair")
  .set("Authorization", "Bearer token")
  .timeout(3000)
  .retry(2);

console.log(`æ‰¾åˆ°äº† ${cats.length} åªçŒ«å’ª`);
```

### ä½¿ç”¨ @keq-request/cli è®©å¼€å‘æ›´é«˜æ•ˆ

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ ä¸å†éœ€è¦ä¸ºæ¯ä¸ª API æ¥å£æ‰‹å†™è¯·æ±‚ä»£ç ï¼š

```typescript
// @keq-request/cli æ ¹æ® Swagger æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
import { getCats, createCat } from "./api/cat_service";

// å®Œæ•´çš„ç±»å‹æç¤ºï¼Œå‚æ•°é”™è¯¯ä¼šåœ¨ç¼–è¯‘æ—¶å‘ç°
const cats = await getCats({ breed: "siamese" })
  .retry(3, 1000)
  .timeout(5000);

// æ‰€æœ‰æ¥å£å…±äº«ç»Ÿä¸€çš„ä¸­é—´ä»¶é€»è¾‘
request
  .useRouter()
  .module("catService", errorHandler());
```

[koa]: https://github.com/koajs/koa
[superagent]: https://github.com/ladjs/superagent

## æ ¸å¿ƒç‰¹æ€§

### ğŸŒ è·¨å¹³å°æ”¯æŒ

åœ¨æµè§ˆå™¨å’Œ Node.js (â‰¥20) ä¸­ä½¿ç”¨åŒä¸€å¥—ä»£ç ï¼ŒåŸºäºæ ‡å‡† Fetch APIï¼Œæ— éœ€æ‹…å¿ƒå…¼å®¹æ€§é—®é¢˜ã€‚

### âš¡ é“¾å¼è°ƒç”¨

æµç•…çš„ API è®¾è®¡ï¼Œè®©è¯·æ±‚é…ç½®ç›´è§‚æ˜“è¯»ï¼š

```typescript
await request
  .post("/cats")
  .send({ name: "mimi", age: 3 })
  .set("Content-Type", "application/json")
  .query("lang", "zh-CN")
  .timeout(5000)
  .retry(2);
```

### ğŸ¯ ä¸­é—´ä»¶ç³»ç»Ÿ

é€šè¿‡ä¸­é—´ä»¶æ‰©å±• Keq çš„èƒ½åŠ›ï¼Œå®˜æ–¹æä¾›äº†ä¸°å¯Œçš„å¼€ç®±å³ç”¨åŠŸèƒ½ï¼š

- **[è¶…æ—¶æ§åˆ¶](./features/timeout)** - é˜²æ­¢è¯·æ±‚é•¿æ—¶é—´æŒ‚èµ·
- **[å¤±è´¥é‡è¯•](./features/retry)** - çµæ´»çš„é‡è¯•ç­–ç•¥
- **[å¹¶å‘æ§åˆ¶](./features/flow-control)** - ç®¡ç†å¹¶å‘è¯·æ±‚æ•°é‡
- **[æ™ºèƒ½åºåˆ—åŒ–](./features/serialize)** - æ ¹æ® Content-Type è‡ªåŠ¨å¤„ç†å“åº”
- **[å¼‚å¸¸å¤„ç†](./libraries/keq-exception)** - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- **[è¯·æ±‚ç¼“å­˜](https://github.com/keq-request/keq-cache)** - å‡å°‘ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚

### ğŸ“˜ TypeScript First

å®Œæ•´çš„ç±»å‹å®šä¹‰å’Œç±»å‹æ¨æ–­ï¼Œé…åˆ @keq-request/cli ç”Ÿæˆçš„ä»£ç ï¼Œè·å¾—æè‡´çš„å¼€å‘ä½“éªŒï¼š

```typescript
// è‡ªåŠ¨æ¨æ–­å“åº”ä½“ç±»å‹
const cat = await request.get<Cat>("/cats/1");
//    ^? Cat

// ä¸¥æ ¼çš„å‚æ•°ç±»å‹æ£€æŸ¥ï¼ˆgetCats ç”± @keq-request/cli ç”Ÿæˆï¼‰
await getCats({ breed: "siamese" });
//              ^^^^^^ ç±»å‹æç¤ºå’Œæ ¡éªŒ
```

### ğŸ¨ çµæ´»çš„è·¯ç”±

ç²¾å‡†æ§åˆ¶ä¸­é—´ä»¶çš„åº”ç”¨èŒƒå›´ï¼š

```typescript
request
  .useRouter()
  .host("api.example.com", authMiddleware())
  .pathname("/admin/**", adminAuthMiddleware())
  .module("catService", errorHandler())
  .method("POST", logMiddleware());
```

### ğŸ› ï¸ ä»£ç ç”Ÿæˆå·¥å…·

**[@keq-request/cli](./libraries/keq-cli)** æ˜¯ Keq çš„æ€æ‰‹çº§åŠŸèƒ½ï¼Œå°† Swagger/OpenAPI æ–‡æ¡£è½¬æ¢ä¸ºç±»å‹å®‰å…¨çš„è¯·æ±‚å‡½æ•°ï¼š

- âœ… è‡ªåŠ¨ç”Ÿæˆè¯·æ±‚å‡½æ•°å’Œ TypeScript ç±»å‹
- âœ… å®Œæ•´çš„æ¥å£å‚æ•°ç±»å‹æ£€æŸ¥
- âœ… æ”¯æŒè·¯ç”±å‚æ•°ã€æŸ¥è¯¢å‚æ•°ã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“
- âœ… é€šè¿‡æ¨¡å—åŒ–ç»„ç»‡ï¼Œç»Ÿä¸€ç®¡ç†ä¸åŒæœåŠ¡çš„æ¥å£
- âœ… ä¿æŒæ‰‹å†™ä»£ç çš„çµæ´»æ€§ï¼Œæ”¯æŒåŠ¨æ€å‚æ•°

## è®¾è®¡å“²å­¦

Keq çš„è®¾è®¡éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **ä¼˜é›…çš„ API**ï¼šé“¾å¼è°ƒç”¨è®©ä»£ç æ›´æ˜“è¯»æ˜“å†™
2. **å¯ç»„åˆæ€§**ï¼šé€šè¿‡ä¸­é—´ä»¶ç»„åˆå¤æ‚åŠŸèƒ½ï¼Œè€Œéè‡ƒè‚¿çš„é…ç½®
3. **ç±»å‹å®‰å…¨**ï¼šå……åˆ†åˆ©ç”¨ TypeScriptï¼Œåœ¨ç¼–è¯‘æœŸå‘ç°é—®é¢˜
4. **å¼€å‘æ•ˆç‡**ï¼šé€šè¿‡ CLI å·¥å…·å‡å°‘é‡å¤åŠ³åŠ¨
5. **çµæ´»å¯æ§**ï¼šæä¾›è¶³å¤Ÿçš„æ‰©å±•ç‚¹ï¼Œæ»¡è¶³å„ç§å®šåˆ¶éœ€æ±‚
